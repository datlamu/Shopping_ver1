@model ProductModel
@{
	var related = ViewBag.RelatedProducts as List<ProductModel> ?? new List<ProductModel>();
	var ratings = ViewBag.ReviewProducts as List<RatingModel> ?? new List<RatingModel>();

	// Nhóm 3 sản phẩm liên quan
	int itemsPerGroup = 3;
	var grouped = related
		.Select((p, index) => new { Product = p, Index = index })
		.GroupBy(x => x.Index / itemsPerGroup)
		.Select(g => g.Select(x => x.Product).ToList())
		.ToList();
}
<div class="row">
	<div class="col-sm-3">
		<partial name="_SidebarPartial" />
	</div>
	<div class="col-sm-9 padding-right">
		<div class="product-details">
			<!--product-details-->
			<div class="col-sm-5">
				<div class="view-product">
					<img src="~/media/products/@Model.Image" alt="@Model.Name" width="100%" />
					<h3>ZOOM</h3>
				</div>
				@*
				<div id="similar-product" class="carousel slide" data-ride="carousel">
					<!-- Wrapper for slides -->
					<div class="carousel-inner">
						<div class="item active">
							<a href=""><img src="images/product-details/similar1.jpg" alt=""></a>
							<a href=""><img src="images/product-details/similar2.jpg" alt=""></a>
							<a href=""><img src="images/product-details/similar3.jpg" alt=""></a>
						</div>
					</div>

					<!-- Controls -->
					<a class="left item-control" href="#similar-product" data-slide="prev">
						<i class="fa fa-angle-left"></i>
					</a>
					<a class="right item-control" href="#similar-product" data-slide="next">
						<i class="fa fa-angle-right"></i>
					</a>
				</div>
				*@
			</div>
			<div class="col-sm-7">
				<div class="product-information">
					<!--/product-information-->
					<h2><b>Tên: @Model.Name</b></h2>
					<p><b>Giá tiền: </b>@FormatCurrency.ToVnCurrency(Model.Price)</p>
					@if (Model.Inventory.QuantityInStock > 0)
					{
						<p><b>Kho: </b>Còn @Model.Inventory.QuantityInStock sản phẩm</p>
						<button type="button" class="btn btn-fefault cart" style="margin-left: 0">
							<i class="fa fa-shopping-cart"></i>
							Thêm giỏ hàng
						</button>
					}
					else
					{
						<p><b>Kho: </b>Hết hàng</p>
					}
					<a href=""><img src="images/product-details/share.png" class="share img-responsive" alt="" /></a>
				</div><!--/product-information-->
			</div>
		</div><!--/product-details-->

		<div class="category-tab shop-details-tab">
			<!--category-tab-->
			<div class="col-sm-12">
				<ul class="nav nav-tabs">
					<li><a href="#details" data-toggle="tab">Mô tả</a></li>
					<li class="active"><a href="#reviews" data-toggle="tab">Đánh giá</a></li>
				</ul>
			</div>
			<div class="tab-content">
				<div class="tab-pane fade" id="details" style="padding:10px">
					<p><b>Mô tả: </b>@Html.Raw(Model.Description)</p>
					<p><b>Thương hiệu: </b>@Model.Brand.Name</p>
					<p><b>Thể loại: </b>@Model.Category.Name</p>
				</div>

				<div class="tab-pane fade active in" id="reviews">
					<div class="col-sm-12">
						@foreach (var item in ratings)
						{
							<p><b>Tên: </b>@item.Name</p>
							<p><b>Email: </b>@item.Email</p>
							<p>
								<b>Đánh giá: </b>
								@for (int i = item.Star; i > 0; i--)
								{
									<i class="fa fa-star checked" style="font-size:16px"></i>
								}
							</p>
							<p><b>Email: </b>@Html.Raw(item.Comment)</p>
							<hr />
						}
						<partial name="_ReviewFormPartial" model="new RatingModel { ProductId = Model.Id }" />

					</div>
				</div>

			</div>
		</div><!--/category-tab-->

		<div class="recommended_items">
			<h2 class="title text-center">Các sản phẩm liên quan</h2>

			<div id="recommended-item-carousel" class="carousel slide" data-ride="carousel">
				<div class="carousel-inner">
					<div class="carousel-inner">
						@for (int i = 0; i < grouped.Count; i++)
						{
							var group = grouped[i];
							<div class="item @(i == 0 ? "active" : "")">
								@foreach (var product in group)
								{
									<div class="col-sm-4">
										<div class="product-image-wrapper">
											<div class="single-products">
												<div class="productinfo text-center">
													<img src="~/media/products/@product.Image" alt="@product.Name" />
													<h2>@FormatCurrency.ToVnCurrency(product.Price)</h2>
													<p>@product.Name</p>
													<a asp-action="Details" asp-route-id="@product.Id" class="btn btn-default add-to-cart">
														<i class="fa fa-shopping-cart"></i> Add to cart
													</a>
												</div>
											</div>
										</div>
									</div>
								}
							</div>
						}
					</div>
				</div>
				@if (related.Count > 3)
				{
					<a class="left recommended-item-control" href="#recommended-item-carousel" data-slide="prev">
						<i class="fa fa-angle-left"></i>
					</a>
					<a class="right recommended-item-control" href="#recommended-item-carousel" data-slide="next">
						<i class="fa fa-angle-right"></i>
					</a>
				}
			</div>
		</div><!--/recommended_items-->

	</div>
</div>
@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		document.addEventListener("DOMContentLoaded", function () {
			const container = document.querySelector(".starContainer");

			if (!container) return;

			const stars = container.querySelectorAll(".fa-star");
			const ratingInput = container.querySelector(".ratingInput");

			stars.forEach(star => {
				star.addEventListener("click", function () {
					const rating = parseInt(this.dataset.value); // Đánh giá
					ratingInput.value = rating;

					stars.forEach(s => {
						const val = parseInt(s.dataset.value);
						s.classList.toggle("checked", val <= rating); // dùng toggle điều chỉnh đánh giá sao
					});
				});
			});
		});
	</script>
}