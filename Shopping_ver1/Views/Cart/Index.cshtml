<div id="cartTableContainer">
	<partial name="_CartTablePartial" model="Model" />
</div>
@section Scripts {
	<script>
		// Tải lại bảng
		function reloadCartTable() {
			$("#cartTableContainer").load("/Cart/GetCartTable", function () {
				attachCartEvents(); // Gắn lại sự kiện sau khi load xong
			});
		}
		// Gắn sự kiện giỏ hàng
		function attachCartEvents() {
		// Chạy khi button được click vào
			$('.increase-cartitem').off('click').on('click', function () {

				// Url Action
				var url = '/Cart/Increase';
				// Lấy id của sản phẩm
				var	id = $(this).val();
				let data = { id };

				// Gọi Ajax
				sendAjax({
					url,
					data,
					onSuccess: function () {
						reloadCartTable();
					}
				});
			});
			$('.decrease-cartitem').off('click').on('click', function () {

				// Url Action
				var url = '/Cart/Decrease';
				// Lấy id của sản phẩm
				var	id = $(this).val();
				let data = { id };

				// Gọi Ajax
				sendAjax({
					url,
					data,
					onSuccess: function () {
						reloadCartTable();
					}
				});
			});

			$('.cart_quantity_input').off('change').on('change', function () {
				let input = $(this);
				let quantity = parseInt(input.val());
				let row = input.closest('tr');
				let productId = row.find('.increase-cartitem').val();

				var url = '/Cart/UpdateQuantity';
				let data = { productId, quantity };

				// Gọi Ajax
				sendAjax({
					url,
					data,
					onSuccess: function () {
						reloadCartTable();
					}
				});
			});

			$('.remove-cartitem').off('click').on('click', function () {

				// Url Action
				var url = '/Cart/Remove';
				// Lấy id của sản phẩm
				var	id = $(this).val();
				let data = { id };

				// Gọi Ajax
				sendAjax({
					url,
					data,
					onSuccess: function () {
						reloadCartTable();
					}
				});
			});
			$('.clear-cart').off('click').on('click', function () {

				// Url Action
				var url = '/Cart/Clear';
				// Lấy id của sản phẩm
				var	id = $(this).val();
				let data = { id };

				// Gọi Ajax
				sendAjax({
					url,
					data,
					onSuccess: function () {
						reloadCartTable();
					}
				});
			});
		}
		$(document).ready(function () {
			attachCartEvents();
		});
	</script>
}